<div class="canteen-chooser">
  <h3>Det finnes allerede kantine<%= canteens.length > 1 ? 'r' : '' %> på denne adressen</h3>
  <p class="canteen-chooser-subtitle">Velg en eksisterende kantine eller opprett en ny for <strong><%= companyName %></strong>.</p>

  <div class="canteen-chooser-options">
    <% canteens.forEach(c => { %>
    <button
      class="canteen-chooser-card"
      hx-post="/api/velg-bedrift"
      hx-vals='<%= JSON.stringify({ orgnr, canteenChoice: "existing", selectedCanteen: c.addressKey }) %>'
      hx-target="#search-results"
      hx-indicator="#search-spinner"
    >
      <span class="canteen-chooser-card-name"><%= c.canteenName || c.street %></span>
      <% if (c.canteenName) { %>
        <span class="canteen-chooser-card-address"><%= c.street %></span>
      <% } %>
      <span class="canteen-chooser-card-meta">
        <%= c.averageRating ? c.averageRating.toFixed(1) + ' ★' : 'Ingen rating' %>
        &middot; <%= c.totalReviews || 0 %> anmeldelse<%= (c.totalReviews || 0) !== 1 ? 'r' : '' %>
        <% if (c.companies && c.companies.length > 0) { %>
          &middot; <%= c.companies.map(co => co.name).join(', ') %>
        <% } %>
      </span>
    </button>
    <% }) %>
  </div>

  <div class="canteen-chooser-new">
    <h4>Opprett ny kantine</h4>
    <form
      hx-post="/api/velg-bedrift"
      hx-target="#search-results"
      hx-indicator="#search-spinner"
    >
      <input type="hidden" name="orgnr" value="<%= orgnr %>">
      <input type="hidden" name="canteenChoice" value="new">
      <input
        type="text"
        name="canteenName"
        placeholder="Navn på kantinen (valgfritt, f.eks. «Kantinen i 2. etasje»)"
        class="form-input"
        maxlength="100"
      >
      <button type="submit" class="btn btn-primary">Opprett ny kantine</button>
    </form>
  </div>
</div>
